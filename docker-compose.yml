version: '3.8'

services:
  # ----------------------------------------
  # 1. FRONTEND SERVICE (Nginx + React/Vite Build)
  # ----------------------------------------
  frontend:
    # บอก Docker ให้ไป Build Image จาก Dockerfile ที่อยู่ในโฟลเดอร์ DGA-frontend/
    build:
      context: ./DGA-frontend
      dockerfile: Dockerfile
    
    # เปิด Port ภายนอก (80) เพื่อเข้าถึง Nginx
    ports:
      - "80:80" 
    
    # กำหนดให้รันหลัง backend พร้อมแล้ว (ถ้า backend มีการเชื่อมต่อฐานข้อมูล)
    depends_on:
      - backend
      
    # ให้รีสตาร์ทอัตโนมัติหากมีปัญหา
    restart: always

  # ----------------------------------------
  # 2. BACKEND SERVICE (Node.js/Express)
  # ----------------------------------------
  backend:
    # สมมติว่า DGA-back มี Dockerfile อยู่
    build: 
      context: ./DGA-back
      dockerfile: Dockerfile

    # เปิด Port ภายนอก (1040) เพื่อให้ Frontend (Dev) หรือการเรียกตรงเข้าถึงได้
    # แต่ปกติแล้ว Frontend ที่รันผ่าน Nginx จะเรียกผ่าน Internal Network
    ports:
      - "1040:1040" 

    # Environment variables (ตัวอย่าง, ต้องปรับใช้จริงตาม Backend)
    environment:
      NODE_ENV: production
      PORT: 1040

    restart: always