version: '3.8'

services:
  # 1. บริการ Back-end (Node.js/Express)
  backend:
    build: 
      context: ./DGA-back
    # ❌ ลบ command: npm run dev ออก เพื่อให้ใช้ CMD ใน Dockerfile (npm start)
    # command: npm run dev 
    working_dir: /usr/src/app
    ports:
      # คง Port 1040 ไว้ตามเดิม
      - "1040:1040" 
    env_file:
      - ./DGA-back/.env
    # Volumes ยังคงไว้สำหรับการพัฒนา
    volumes:
      - ./DGA-back:/usr/src/app
      - /usr/src/app/node_modules
    environment:
      - NODE_ENV=development

  # 2. บริการ Front-end (Nginx Server)
  frontend:
    build: 
      context: ./DGA-frontend
    ports:
      # ⭐️ คง Host Port 8083 แต่แมปเข้า Container Port 80 (Nginx)
      - "8083:80" 
    # ❌ ลบ volumes ออกถ้าจะใช้ Deploy จริง (แต่ถ้ายังอยู่ในระหว่างการพัฒนา/Staging อาจจะยังคง volumes เพื่อความสะดวก)
    # volumes:
    #   - ./DGA-frontend:/app
    #   - /app/node_modules
    depends_on:
      - backend