version: '3.8'

services:
  # 1. ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Back-end (Node.js/Express)
  backend:
    build: 
      context: ./DGA-back
    # üí° ‡πÉ‡∏ä‡πâ 'npm start' ‡πÅ‡∏ó‡∏ô 'npm run dev' ‡∏ñ‡πâ‡∏≤ package.json ‡∏°‡∏µ 'start' script ‡∏ó‡∏µ‡πà‡∏î‡∏µ
    # ‡∏ñ‡πâ‡∏≤ 'npm run dev' ‡∏°‡∏µnodemon ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏°‡∏µ nodemon ‡πÉ‡∏ô container
    command: npm run dev 
    working_dir: /usr/src/app
    ports:
      - "1040:1040"
    # ‡∏î‡∏∂‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ ENV ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Consumer Keys (DGA)
    env_file:
      - ./DGA-back/.env
    volumes:
      # Map host code to container workdir (‡πÄ‡∏û‡∏∑‡πà‡∏≠ Hot Reload)
      - ./DGA-back:/usr/src/app
      # Explicitly isolate node_modules
      - /usr/src/app/node_modules
    environment:
      - NODE_ENV=development
      # üí° ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏∏ Frontend URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CORS (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô server.js)
      - FRONTEND_URL=http://localhost:8083 
      # ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Frontend ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏´‡∏≤ Backend ‡∏ú‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠ Service Name 'backend' ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà localhost:1040

  # 2. ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Front-end (Vite/React)
  frontend:
    build: 
      context: ./DGA-frontend
    working_dir: /app
    ports:
      # ‚úÖ ‡∏Ñ‡∏á Port ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ: Host Port 8083 --> Container Port 5174
      - "8083:5174" 
    volumes:
      # Map host code to container workdir (‡πÄ‡∏û‡∏∑‡πà‡∏≠ Hot Reload)
      - ./DGA-frontend:/app 
      # Explicitly isolate node_modules
      - /app/node_modules
    environment:
      - NODE_ENV=development
      # ‚≠êÔ∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: Environment variable ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Frontend ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Backend ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
      # Frontend ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠ Service Name 'backend' ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô Docker network
      - VITE_BACKEND_URL=http://backend:1040 
    depends_on:
      - backend